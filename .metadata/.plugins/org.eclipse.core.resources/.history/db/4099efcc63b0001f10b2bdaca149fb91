//
//public class IngestCSV {
//	// this code should read in the CSV file and put it in
//	// a sqlite db table
//}


import java.io.*;
import java.sql.*;
import java.text.*;
import org.apache.commons.csv.*;

public class IngestCSV {

    private static Connection connect() {
        // SQLite connection string
        String url = "jdbc:sqlite:path_to_your_database.db";
        Connection conn = null;
        try {
            conn = DriverManager.getConnection(url);
        } catch (SQLException e) {
            System.out.println(e.getMessage());
        }
        return conn;
    }

    public static void readCSVIntoDB(String filePath) {
        String sql = "INSERT INTO Customers(CustomerId, FirstName, LastName, Company, City, Country, Phone1, Phone2, Email, SubscriptionDate, Website) VALUES(?,?,?,?,?,?,?,?,?,?,?)";

        try (Connection conn = connect();
             BufferedReader br = new BufferedReader(new FileReader(filePath));
             CSVParser csvParser = new CSVParser(br, CSVFormat.DEFAULT.withFirstRecordAsHeader())) {
            PreparedStatement pstmt = conn.prepareStatement(sql);

            for (CSVRecord record : csvParser) {
                pstmt.setString(1, record.get("Customer Id"));
                pstmt.setString(2, record.get("First Name"));
                pstmt.setString(3, record.get("Last Name"));
                pstmt.setString(4, record.get("Company"));
                pstmt.setString(5, record.get("City"));
                pstmt.setString(6, record.get("Country"));
                pstmt.setString(7, record.get("Phone 1"));
                pstmt.setString(8, record.get("Phone 2"));
                pstmt.setString(9, record.get("Email"));
                pstmt.setString(10, record.get("Subscription Date"));
                pstmt.setString(11, record.get("Website"));
                pstmt.executeUpdate();
            }
        } catch (FileNotFoundException e) {
            System.out.println("File not found: " + e.getMessage());
        } catch (IOException e) {
            System.out.println("I/O Error: " + e.getMessage());
        } catch (SQLException e) {
            System.out.println("Database Error: " + e.getMessage());
        }
    }

    public static void main(String[] args) {
        if (args.length < 1) {
            System.out.println("Please provide the CSV file path as the first argument.");
            return;
        }
        readCSVIntoDB(args[0]);
    }
}
